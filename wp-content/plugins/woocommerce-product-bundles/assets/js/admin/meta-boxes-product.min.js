jQuery(function(n){function _(i){var e=this;this.$element=i,this.$content=i.find("div.item-data"),this.$discount=this.$content.find(".discount"),this.$visibility=this.$content.find(".item_visibility"),this.$price_visibility=this.$content.find(".price_visibility"),this.$allowed_variations=this.$content.find("div.allowed_variations"),this.$default_variation_attributes=this.$content.find("div.default_variation_attributes"),this.$custom_title=this.$content.find("div.custom_title"),this.$custom_description=this.$content.find("div.custom_description"),this.$override_title=this.$content.find(".override_title"),this.$override_description=this.$content.find(".override_description"),this.$hide_thumbnail=this.$content.find(".hide_thumbnail"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".options_group"),this.$priced_individually_input=this.$content.find(".priced_individually input"),this.$override_variations_input=this.$content.find(".override_variations input"),this.$override_defaults_input=this.$content.find(".override_default_variation_attributes input"),this.$override_title_input=this.$override_title.find("input"),this.$override_description_input=this.$override_description.find("input"),this.$price_visibility_product_input=this.$price_visibility.find("input.price_visibility_product"),this.$price_visibility_cart_input=this.$price_visibility.find("input.price_visibility_cart"),this.$price_visibility_order_input=this.$price_visibility.find("input.price_visibility_order"),this.$visibility_product_input=this.$visibility.find("input.visibility_product"),this.$visibility_cart_input=this.$visibility.find("input.visibility_cart"),this.$visibility_order_input=this.$visibility.find("input.visibility_order"),this.priced_individually_input_changed=function(){e.$priced_individually_input.is(":checked")?(e.$discount.show(),e.$price_visibility.show()):(e.$discount.hide(),e.$price_visibility.hide())},this.override_variations_input_changed=function(){e.$override_variations_input.is(":checked")?e.$allowed_variations.show():e.$allowed_variations.hide()},this.override_defaults_input_changed=function(){e.$override_defaults_input.is(":checked")?e.$default_variation_attributes.show():e.$default_variation_attributes.hide()},this.override_title_input_changed=function(){e.$override_title_input.is(":checked")?e.$custom_title.show():e.$custom_title.hide()},this.override_description_input_changed=function(){e.$override_description_input.is(":checked")?e.$custom_description.show():e.$custom_description.hide()},this.visibility_product_input_changed=function(){e.$visibility_product_input.is(":checked")?(e.$override_title.show(),e.$override_description.show(),e.$hide_thumbnail.show(),e.override_title_input_changed(),e.override_description_input_changed()):(e.$override_title.hide(),e.$override_description.hide(),e.$hide_thumbnail.hide(),e.$custom_description.hide(),e.$custom_title.hide())},this.toggled_visibility=function(i){e["$visibility_"+i+"_input"].is(":checked")?e["$price_visibility_"+i+"_input"].css("opacity",1):e["$price_visibility_"+i+"_input"].css("opacity",.5)},this.section_changed=function(i){e.$section_links.removeClass("current"),i.addClass("current"),e.$sections.addClass("options_group_hidden"),e.$content.find(".options_group_"+i.data("tab")).removeClass("options_group_hidden")},this.initialize=function(){e.priced_individually_input_changed(),e.override_variations_input_changed(),e.override_defaults_input_changed(),e.override_title_input_changed(),e.override_description_input_changed(),e.visibility_product_input_changed(),e.toggled_visibility("product"),e.toggled_visibility("cart"),e.toggled_visibility("order"),e.$element.sw_select2()},this.initialize()}var l,i,u,p=n("p._wc_pb_edit_in_cart_field"),d=n("select#product-type"),h=n("select#_wc_pb_group_mode"),s=n("#bundled_product_data"),b=s.find(".wc-metaboxes-wrapper"),v=s.find(".toolbar"),o=n(".wc-bundled-items"),f=n(".wc-bundled-item",o),c=n("#bundled_product",s),a={},g=f.length,m={message:null,overlayCSS:{background:"#fff",opacity:.6}},t=s.parent().find("#shipping_product_data"),r=n("input#_virtual"),$=r.prop("checked"),w=!1,y=n("input#_virtual_bundle"),e=t.find(".options_group.bundle_type"),k=e.find(".bundle_type_options li");function C(){0<f.length?(b.removeClass("no-items"),v.removeClass("disabled")):(b.addClass("no-items"),v.addClass("disabled"))}n.fn.wc_bundles_select2=function(){n(document.body).trigger("wc-enhanced-select-init")},n(".bundle_stock_msg").appendTo("._manage_stock_field .description"),n("#_sold_individually").closest(".form-field").addClass("hide_if_bundle"),n("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_bundle"),n(".show_if_simple:not(.hide_if_bundle)").addClass("show_if_bundle"),n("body").on("woocommerce-product-type-change",function(i,e){"bundle"===e&&(n(".show_if_external").hide(),n(".show_if_bundle").show(),n("input#_manage_stock").trigger("change"),n("#_nyp").trigger("change"),w&&y.prop("checked",r.prop("checked")),y.prop("checked")||r.prop("checked",!1).change(),"unassembled"===k.find("input.bundle_type_option:checked").first().val()&&(t.addClass("bundle_unassembled"),s.addClass("bundle_unassembled")))}),n("form#post").on("submit",function(){var i,e,t;"bundle"===d.val()&&(i=n(this),e=n('<input type="hidden" name="pb_post_control_var" value="1"/>'),t=n('<input type="hidden" name="pb_post_test_var" value="1"/>'),i.prepend(e),i.append(t))}),h.on("change",function(){-1===n.inArray(h.val(),wc_bundles_admin_params.group_modes_with_parent)?p.hide():p.show()}),n("input#_downloadable").on("change",function(){d.trigger("change")}),c.on("change",function(){var i=c.val(),i=!!(i&&0<i.length)&&i.shift();if(!i)return!1;c.val([]).trigger("change"),s.block(m),g++;var e={action:"woocommerce_add_bundled_product",post_id:woocommerce_admin_meta_boxes.post_id,id:g,product_id:i,security:wc_bundles_admin_params.add_bundled_product_nonce};return setTimeout(function(){n.post(woocommerce_admin_meta_boxes.ajax_url,e,function(i){var e,t;""!==i.markup?(o.append(i.markup),e=n(".wc-bundled-item",o).last(),t="bundled_item_"+g,e.data("bundled_item_id",t),a[t]=new _(e),s.triggerHandler("wc-bundled-products-changed"),e.find(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),e.wc_bundles_select2(),s.trigger("wc-bundles-added-bundled-product")):""!==i.message&&window.alert(i.message),c.selectSW("open"),c.selectSW("close"),s.unblock()})},250),!1}),b.on("click",".expand_all",function(){return n(this).hasClass("disabled")||n.each(a,function(i,e){e.$element.addClass("open").removeClass("closed")}),!1}).on("click",".close_all",function(){return n(this).hasClass("disabled")||n.each(a,function(i,e){e.$element.addClass("closed").removeClass("open")}),!1}),s.on("wc-bundled-products-changed",function(){(f=n(".wc-bundled-item",o)).each(function(i,e){n(".item_menu_order",e).val(i)}),C()}).one("wc-bundles-added-bundled-product",function(){b.removeClass("wc-bundle-metaboxes-wrapper--boarding")}),o.on("click","a.edit-product",function(i){i.stopPropagation()}).on("click","a.remove_row",function(i){var e=n(this).closest(".wc-bundled-item"),t=e.data("bundled_item_id");e.find("*").off(),e.remove(),delete a[t],s.triggerHandler("wc-bundled-products-changed"),i.preventDefault()}).on("change",".priced_individually input",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].priced_individually_input_changed()}).on("change",".override_variations input",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].override_variations_input_changed()}).on("change",".override_default_variation_attributes input",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].override_defaults_input_changed()}).on("change",".override_title input",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].override_title_input_changed()}).on("change",".override_description input",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].override_description_input_changed()}).on("change","input.visibility_product",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id"),i=a[i];i.visibility_product_input_changed(),i.toggled_visibility("product")}).on("change","input.visibility_cart",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].toggled_visibility("cart")}).on("change","input.visibility_order",function(){var i=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[i].toggled_visibility("order")}).on("click",".subsubsub a",function(i){var e=n(this),t=n(this).closest(".wc-bundled-item").data("bundled_item_id");a[t].section_changed(e),i.preventDefault()}),f.each(function(i){var e=n(this),i="bundled_item_"+i;e.data("bundled_item_id",i),a[i]=new _(e)}),o.sortable({items:".wc-bundled-item",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(i,e){e.item.css("background-color","#f6f6f6")},stop:function(i,e){e.item.removeAttr("style"),s.triggerHandler("wc-bundled-products-changed")}}),C(),e.detach().prependTo(t),t.find(".form-field._weight_field").after(e.find(".form-field.bundle_aggregate_weight_field")),y.on("change",function(){var i=y.prop("checked");r.prop("checked")!==i&&r.prop("checked",i).trigger("change"),i?s.addClass("bundle_virtual"):s.removeClass("bundle_virtual")}),r.on("change",function(){r.prop("checked")!==$&&(w=!0)}),k.on("click",function(){var i=n(this),e=i.find("input").prop("checked","checked").val();k.removeClass("selected"),i.addClass("selected"),"assembled"===e?(t.removeClass("bundle_unassembled"),s.removeClass("bundle_unassembled")):"unassembled"===e&&(t.addClass("bundle_unassembled"),s.addClass("bundle_unassembled"))}),"yes"===wc_bundles_admin_params.is_first_bundle&&(d.val("bundle").trigger("change").trigger("focus"),setTimeout(function(){n(".bundled_products_tab a").trigger("click")},500)),e=s.find(".add_bundled_product"),i=e.find(".sw-expanding-button"),u=n(document.body),i.length?(i.sw_select2(),i.on("click",function(i){i.stopPropagation(),clearTimeout(l);var e=n(this),t=e.find(".select2-search__field");e.addClass("sw-expanding-button--open"),l=setTimeout(function(){t.trigger("focus")},700),c.one("change",function(){e.removeClass("sw-expanding-button--open")})}),u.on("click",".select2-container",function(i){i.stopPropagation()}),u.on("click",function(){i.removeClass("sw-expanding-button--open")})):e.sw_select2(),d.trigger("change"),h.trigger("change")});